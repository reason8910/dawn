<!-- CSS -->
<link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css" defer="defer">
<!-- JavaScript -->
<script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js" defer="defer"></script>
{% style %}
.section-{{ section.id }}-padding {
  padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
  padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
}
.main-carousel{
   padding-top: 8px;
}
.main-carousel:focus-visible{
  outline: 0 solid rgba(var(--color-foreground), 0);
  -webkit-box-shadow: none;
  -moz-box-shadow: none;
  box-shadow: none;  
  }
.carousel-cell {
  padding-right: {{section.settings.grid_gap}}px;
}
.carousel-cell img {
  height: {{section.settings.height}}px;
}
.flickity-button{ 
  {% if section.settings.show_arrows == false %} display: none; {% endif %}
} 
.flickity-page-dots{ 
  {% if section.settings.show_dots == false %} display: none; {% endif %}
} 
{% endstyle %}

<div class="meta-image-carousel {% unless section.settings.full_width != blank %} page-width{% endunless %} section-{{ section.id }}-padding">
  {%- if section.settings.heading != blank -%}
    <div class="page-width">{{ section.settings.heading }}</div>
  {%- endif -%}
  
  {%- if request.page_type == "article" -%} 
    {% assign path = article.metafields.custom.gallery %}
  {%- endif -%}
  {%- if request.page_type == "page" -%} 
    {% assign path = page.metafields.custom.gallery %}
  {%- endif -%}
    {%- if request.page_type == "product" -%} 
    {% assign path = product.metafields.custom.gallery %}
  {%- endif -%}

{%- if path != blank -%}

  
    <!-- Flickity Carousel Start -->
    <div class="main-carousel" data-flickity='{ "cellAlign": "left", "contain": true, "initialIndex": 2, "cellAlign": "center", "autoPlay": {{ section.settings.autoplay }} }'>

    {% for image in path.value %}
    <div class="carousel-cell">
    
    <img loading="lazy" src=" {{ image | image_url: height: section.settings.height }}" data-aspectratio="{{ image.aspect_ratio }}" data-sizes="auto" />
    
    <noscript>
    <img class="grid-product__image" loading="lazy" src="{{ image | image_url: height: section.settings.height }}">
    </noscript>
    
    </div>
    {% endfor %}
    </div>      
    <!-- Flickity Carousel End -->    
    
 
  {%- endif -%}
</div>

{% schema %}
    {
      "name": "Metafield Carousel",
      "settings": [
        {
          "type": "richtext",
          "id": "heading",
          "label": "Heading",
          "default": "<h2>Metafield Gallery Carousel</h2>",
          "info": "Add a metafield to your page, article or product with the name 'Gallery' with type: 'File' and select 'List of files'. Save metafield, then bulk add images to your page, article or product metafield. These will automatically populate in this section."
        },
        {
          "type": "range",
          "id": "grid_gap",
          "label": "Grid gap",
          "min": 0,
          "max": 50,
          "step": 1,
          "default": 10
        },
        {
          "type": "range",
          "id": "height",
          "label": "Image height",
          "min": 0,
          "max": 1000,
          "step": 50,
          "default": 600
        },    
        {
          "type": "checkbox",
          "id": "full_width",
          "label": "Full width gallery",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "autoplay",
          "label": "Autoplay",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "loop",
          "label": "Autoplay",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "show_arrows",
          "label": "Show arrows",
          "default": true
        },  
        {
          "type": "checkbox",
          "id": "show_dots",
          "label": "Show dots",
          "default": true
        },         
        {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_top",
        "default": 36
      },
      {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_bottom",
        "default": 36
      }
      ],
      "presets": [
        {
          "name": "Metafield Gallery Carousel",
          "category": "Image"
        }
      ]
    }
    {% endschema %}